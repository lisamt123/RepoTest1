<apex:page controller="OppClone">
<apex:form >
	
	<script>
    	function setFocusOnLoad() {}
    </script>
	
	<script type="text/javascript"> 
	  function openLookup(baseURL, width, modified, searchParam){
	    var originalbaseURL = baseURL;
	    var originalwidth = width;
	    var originalmodified = modified;
	    var originalsearchParam = searchParam;
	 
	    var lookupType = baseURL.substr(baseURL.length-3, 3);
	    if (modified == '1') baseURL = baseURL + searchParam;
	 
	    var isCustomLookup = false;
	 
	    // Following "001" is the lookup type for Account object so change this as per your standard or custom object
	    if(lookupType == "001"){
	 
	      var urlArr = baseURL.split("&");
	      var txtId = '';
	      if(urlArr.length > 2) {
	        urlArr = urlArr[1].split('=');
	        txtId = urlArr[1];
	      }
	 
	      // Following is the url of Custom Lookup page. You need to change that accordingly
	      baseURL = "/apex/CustomAccountLookup?txt=" + txtId;
	 
	      // Following is the id of apex:form control "myForm". You need to change that accordingly
	      baseURL = baseURL + "&frm=" + escapeUTF("{!$Component.myForm}");
	      if (modified == '1') {
	        baseURL = baseURL + "&lksearch=" + searchParam;
	      }
	 
	      // Following is the ID of inputField that is the lookup to be customized as custom lookup
	      if(txtId.indexOf('Account') > -1 ){
	        isCustomLookup = true;
	      }
	    }
	 
	 
	    if(isCustomLookup == true){
	      openPopup(baseURL, "lookup", 350, 480, "width="+width+",height=480,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no", true);
	    }
	    else {
	      if (modified == '1') originalbaseURL = originalbaseURL + originalsearchParam;
	      openPopup(originalbaseURL, "lookup", 350, 480, "width="+originalwidth+",height=480,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no", true);
	    } 
	  }
	</script>
	
	
 	<div style="position:relative; overflow:auto;"> 
        
    <apex:outputPanel >
        <apex:actionStatus id="status2">
            <apex:facet name="start">
                <div style="width: 100%; height: 100%; background-color:#fbfbfb; opacity:0.65;" class="waitingSearchDiv" id="el_loading">
                    <div class="waitingHolder" style="top: 60px; ">
                        <img src="/img/loading.gif" class="waitingImage" title="Please Wait..." />
                        <span class="waitingDescription">Cloning...</span>
                    </div>
                </div>
            </apex:facet>
        </apex:actionStatus>
    </apex:outputPanel>
	
	<apex:outputPanel id="theOp">
		<apex:pageBlock title="Clone Opportunity" mode="maindetail">
			
			<apex:pageBlockSection showHeader="true" title="Original" columns="1">
				<apex:pageBlockSectionItem >
						<apex:outputLabel value="Original Opportunity" />
						<apex:outputLink value="/{!oppId}" target="_blank">{!originalOpp.Name}</apex:outputLink>
 				</apex:pageBlockSectionItem> 
 				<apex:pageBlockSectionItem >
						<apex:outputLabel value="Account" />
						<apex:outputLink value="/{!originalOpp.AccountId}" target="_blank">{!originalOpp.Account.Name}</apex:outputLink>
				</apex:pageBlockSectionItem>
			</apex:pageBlockSection>
			<apex:pageBlockSection showHeader="true" title="Clones" columns="1">
				<!-- 
				<apex:pageBlockSectionItem >
						<apex:outputLabel value="Clone Opportunity" />
						<apex:inputText value="{!clonedOppName}" size="75" />
				</apex:pageBlockSectionItem>
				-->
				<apex:pageBlockSectionItem >
						<apex:outputLabel value="Clone Opportunity Account" /> 
						<!-- 
						<apex:inputField id="Account" value="{!originalOpp.AccountId}" />
						-->
						<apex:inputField id="Account" value="{!clonedOpp.AccountId}" />
				</apex:pageBlockSectionItem> 
				<apex:repeat value="{!newLinks}" var="nl">
					<apex:pageBlockSectionItem rendered="{!showNewURL}">
						<apex:outputLabel value="New Cloned Opportunity" style="color:green;" />
						<apex:outputLink value="/{!nl.oppId}" style="color:green;" target="_blank">{!nl.oppName}</apex:outputLink>
					</apex:pageBlockSectionItem>
				</apex:repeat>   
			</apex:pageBlockSection>  
			
			
			<apex:pageBlockButtons location="bottom">
				
				<apex:commandButton id="btnClone" action="{!performClone}" rerender="theOp" status="status2" value="Clone" />
				
			</apex:pageBlockButtons> 
		
		</apex:pageBlock>
	</apex:outputPanel>
	
	</div>
	
</apex:form>
</apex:page>