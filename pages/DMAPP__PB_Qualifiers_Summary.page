<apex:page showHeader="false" standardController="Opportunity" extensions="DMAPP.BrandOverrideController,DMAPP.PB_QualifierController" action="{! logLaunchpadUsage }" sidebar="false" docType="html-5.0">
    
	<c:jQuery jQueryUI="true" />
    
    <c:MobileRedirect smartOM="true" />
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>The TAS Group</title>
        <style>
        
            /* Standard styles */       
            body {
                color: #222;
                font-family: Arial, Helvetica, sans-serif;
                font-size:12px;
            }
            
            ul li, ol li { margin: 0; }
            
                .smartOM {
                	background-color: #FFF;
                    border: 1px solid #CCC;
                    border-radius: 8px;
                    float: left;
                    max-width: 933px;
                    min-width: 768px;                   
                    width: 100%;
                }   
        
                    .smartOMBranding {
                        background: url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/bg_pad_header.png') }) left top repeat-x;
                        border-radius: 8px 8px 0 0;
                        clear: both;
                        display: block;
                        float: left;
                        width: 100%;            
                    }
        
                      .smartOMBrandingLeft { 
                          float: left;
                          margin-left: 1%;
                        }
                      
                            .smartOMBrandingLeft img {
                                float: left;
                            }
                    
                        .smartOMBrandingRight { 
                          float: right;
                          margin-right: 1%;
                        }               
                    
                    .noLicenseText {
                        margin: 75px auto 50px;
                        text-align: center;
                    }
            
                    .transparency {
                        background: url('{! URLFOR($Resource.Common, 'panel/images/PB_LaunchPad_Shadow.png') }') center 40px no-repeat;
                        background-color: #FFF;
                        background-size: 100% auto;
                        border-radius: 8px;
                        filter: alpha(opacity=75); /* IE8 and earlier */
                        font-size: 150%; /* 24px / 16px */
                        opacity: .75;           
                        text-align: center;
                        vertical-align: middle;
                    }
            
                    form.TRANSPARENT {
					    background-color: #FFFFFF;
					    border: 1px solid #CCCCCC;
					    border-radius: 8px;
					    width: 99%;
                    }
            
                    .TRANSPARENCY {
                    	/*  background: url('{! URLFOR($Resource.Common, 'panel/images/PB_LaunchPad_Shadow_Mobile.png') }') no-repeat; */
                    	/* FIX FOR DMDEV-3193 */
                        background: url('{! URLFOR($Resource.Common, 'panel/images/PB_LaunchPad_Shadow_Mobile_2.png') }') no-repeat;
                        background-color: #FFF;
                        background-size: 100% auto;
                        border-radius: 8px;
                        filter: alpha(opacity=75); /* IE8 and earlier */
                        font-size: 150%; /* 24px / 16px */
                        opacity: .80;           
                        text-align: center;
                        vertical-align: middle;
                    }
            
                        .TRANSPARENCY a, .transparency a {
                            color: #6060E0;
                            text-decoration: none;
                        }
            
                            .TRANSPARENCY a:hover, .transparency a:hover { 
                                color: #6060E0;
                                text-decoration: underline;
                            }
            
                        .TRANSPARENCY {
                            font-size: large;
                        }
            
                        .unavailable {
                            color: #000;
                            margin: 0 auto; 
                            padding: 100px 0;
                        }
        
                .TAS_playbook_container {
                    cursor: default;
                    padding: 35px 5% 20px 2%; /* 35px / 768px */
                    position: relative;
                }
        
                    .TAS_playbook_left {
                        float: left;
                        width: 55%; 
                    }
                    
                        .TAS_time_bar_container {
                            display: block;
                            height: 33px;
                            position: relative;
                            padding: 63px 1% 0; /* 8px / 768px */
                            width: 80%;
                        }
                        
                            .time_bar { margin-top: 13px; }
                        
                                .TAS_time_bar_start, .TAS_time_bar_length, .TAS_time_bar_end { margin-top: 5px; }
                
                                .TAS_time_bar_start {
                                    left: 0;
                                    position: absolute;                 
                                    z-index: 2;
                                }
                    
                                    .TAS_time_bar_start span.TAS_point_marker {
                                        background: url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/img_timeline_point.png') }) right top no-repeat;
                                        height: 20px;                       
                                        left: -4px;
                                        position: absolute;                     
                                        top: -12px;
                                        width: 20px;
                                    }
                    
                                    .TAS_time_bar_start span.TAS_point_value {
                                        display: block;
                                        margin-top: 15px;
                                        text-align: left;
                                    }
                    
                                    .TAS_time_bar_end {
                                        position: absolute;
                                        right: 0;
                                        z-index: 2;
                                    }
                    
                                    .TAS_time_bar_end span.TAS_point_marker {
                                        background: url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/img_timeline_point.png') }) right top no-repeat;
                                        height: 20px;                       
                                        position: absolute;
                                        right: -5px;
                                        top: -12px;
                                        width: 20px;
                                    }
                    
                                    .TAS_time_bar_end span.TAS_point_value {
                                        display: block;
                                        margin-top: 15px;
                                        text-align: right;
                                    }
                        
                                    .TAS_time_bar_end span.TAS_point_value_isDaysBetween {
                                        color: red;
                                        display: block;
                                        margin-top: 20px;
                                        text-align: right;                  
                                    }
                        
                                .TAS_time_bar_length {
                                    background-color: #CBD5E2;
                                    border-top: 1px solid #ADB5C0;
                                    height: 5px;
                                    position: relative;
                                    z-index: 1;
                                }
                    
                                .TAS_time_bar_completed {
                                    background-color: #5979A0;
                                    border-top: 1px solid #374A61;
                                    height: 5px;
                                    left: 0;
                                    position: absolute;
                                    top: -1px;            
                                }
                            
                                    .TAS_time_bar_completed .TAS_time_bar_marker {
                                        background: url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_timeline_marker.png') }) center bottom no-repeat;
                                        height: 25px;
                                        margin-right: -20px;
                                        position: absolute;     
                                        text-align: center;
                                        right: 0;
                                        top: -28px;     
                                        width: 40px;
                                    }
                
                                    .TAS_time_bar_marker { color: #5979A0; }
                                    
                            .TAS_time_bar_extra {
                                background-color: #C00;
                                border-top: 1px solid #900;
                                height: 5px;
                                position: absolute;
                                right: 0;
                                top: -1px;
                            }                   
                        
                        .TAS_time_bar_percentage {
                            color: #5979A0;
                            font-size: 250%; /* 30px / 12px */
                            padding-top: 10px;
                            position: absolute;
                            right: -5%;
                            top: 0;
                        }
                        
                ul.pb_values {    
                    float: left;
                    list-style: none;
                    margin: 35px 0 15px;
                    padding: 0;
                    width: 100%;    
                }
        
                    ul.pb_values li {
                        border: 1px solid #CBD5E2;
                        border-radius: 5px;
                        float: left;
                        font-size: 92%; /* 11px / 12px */
                        padding: 0 1%;
                        width: 105px;
                    }
            
                        ul.pb_values li:first-child {
                            margin-right: 2%; 
                            width: 125px;
                        }
           
                        ul.pb_values li.last { margin-left: 2%; }      
        
                        ul.pb_values li .pb_label {     
                            display: block;
                            float: left;
                            padding: 13px 0 13px 2%;            
                        }
                
                            ul.pb_values li .pb_icon {
                                display: block;
                                float: left;
                                margin: 8px 1%;   
                            }
                
                                ul.pb_values li .pb_icon img { 
                                    vertical-align: middle;
                                    width: 100%;
                                }               
                    
                                .mix-icon-small { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_value_small.png') }') left top no-repeat; }
                
                                .mix-icon-medium { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_value_medium.png') }') left top no-repeat; }
                            
                                .mix-icon-large { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_value_large.png') }') left top no-repeat; }
                            
                                .duration-icon-grey { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_speed_grey.png') }') left top no-repeat; }
                            
                                .duration-icon-slow { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_speed_slow.png') }') left top no-repeat; }
                            
                                .duration-icon-medium { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_speed_medium.png') }') left top no-repeat; }
                                
                                .duration-icon-fast { background: url('{! URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_speed_fast.png') }') left top no-repeat; }                     
                            
                                .server-icon {
                                    height: 24px;
                                    margin-left: 5% !important;
                                    width: 32px;
                                }
                    
                    .TAS_playbook_right {
                        float: left;
                        margin-left: 2%;                
                        text-align: left;
                        width: 43%;
                    }
                    
                        .forward-link-holder { display: block; }
            
                            .forward-link { float: right; } 
        
                        ul.pb_stages {
                            float: left;                            
                            list-style: none;
                            margin: 0;
                            padding: 0;             
                            width: 100%;                
                        }
                        
                        .TAS_point_value, ul.pb_stages { 1.1em;}
            
                            ul.pb_stages li {
                                clear: both;
                                display: block;
                                float: left;
                                margin: 3px 0;                  
                                width: 100%;               
                            }
                
                                ul.pb_stages li .pb_stage_label {
                                    color: #2C3B51;
                                    float: left;
                                    position: relative;
                                    width: 47.5%;
                                    
                                }
                    
                                    ul.pb_stages li .pb_stage_label.pb_stage_selected {
                                        color: #5979A0;
                                        font-weight: bold;                        
                                    }
                    
                                        ul.pb_stages li .pb_stage_label.pb_stage_selected span.pb_arrow {
                                            background: url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/pb_selected_arrow.png') }) left top no-repeat;
                                            display: block;
                                            height: 12px;
                                            position: absolute;                         
                                            top: 1px;
                                            left: -20px;
                                            width: 16px;
                                        }
                    
                                ul.pb_stages li .pb_stage_progress_bar {
                                    background-color: #E3E3E3;
                                    border-radius: 5px;
                                    float: left;
                                    height: 16px;
                                    position: relative;
                                    width: 41%;                     
                                }
                    
                                    ul.pb_stages li .pb_stage_progress_bar .pb_stage_progress_bar {
                                        border-radius: 5px;                         
                                        left: 0;
                                        height: 16px;
                                        position: absolute; 
                                        top:0;                                                  
                                    }                   
                        
                                        .pb_stage_red { background:url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/img_progress_red.png') }) left top repeat-x; }
                                        
                                        .pb_stage_yellow { background:url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/img_progress_yellow.png') }) left top repeat-x; }
                                        
                                        .pb_stage_green { background:url({! URLFOR($Resource.SmartOM, 'launchpad/playbook/img_progress_green.png') }) left top repeat-x; }
                        
                                ul.pb_stages li .pb_stage_value { float: right; }
                            
                /* Dynamic styles for Playbook Launchpad progress bar */        
                <apex:outputText rendered="{! !hasNoLicenses && hasShadowOpp }">
                  <apex:outputText rendered="{! PlaybookLaunchpadDetails.isSalesProcess }">
                
                  {! IF (PlaybookLaunchpadDetails.isClosed, '.TAS_time_bar_length { background-color: #5979A0; }', '') }
                
                    .TAS_time_bar_marker { display: {! IF (PlaybookLaunchpadDetails.isClosed, 'none', 'block') }; }
                    
                    .TAS_time_bar_completed { width: {! PlaybookLaunchpadDetails.pastPercent }%; }
                    
                    .TAS_time_bar_future { width: {! PlaybookLaunchpadDetails.futurePercent }%; }       
                
                      .TAS_time_bar_extra { width: {! PlaybookLaunchpadDetails.extraPercent }%; }       
                    
                  </apex:outputText>
                </apex:outputText>
            
                /* iPad portrait and landscape styles */                    
                @media only screen
                    and (min-device-width: 768px) 
                    and (max-device-width: 1024px) 
                    and (-webkit-min-device-pixel-ratio: 1),
                    
                /* Windows 8 tablet portrait styles */              
                only screen
                    and (min-device-width : 768px) 
                    and (max-device-width : 800px) {
                    
                        .smartOM { 
                            min-width: 680px !important;
                            max-width: 680px !important;
                        }
                        
                            .TAS_playbook_container {
                                padding-left: 3%;
                                padding-right: 2%;
                            }
                                
                                .unavailable { 
                                    margin: 0 auto;
                                    padding: 85px 0 75px;
                                }
                                
                                        ul.pb_values li:first-child { width: 100px; }
                                
                                        ul.pb_values li .pb_label {
                                            padding: 8px 0 8px 8%; 
                                            width: 47%;
                                        }
                                    
                                        ul.pb_values li .pb_icon { margin: 10px 1%; }               
                    
                                        .TAS_time_bar_start span.TAS_point_marker { left: -6px; }   
                                        
                                        .TAS_time_bar_end span.TAS_point_marker { right: -6px; }                                        
                                                            
                                    ul.pb_stages li .pb_stage_label { width: 52%; }
                                        
                                    ul.pb_stages li .pb_stage_progress_bar { width: 33%; }                          
   
                }
                
                /* Salesforce1-specific styles */        
        		html.salesforce1 { height: auto; }
                
                .salesforce1 body { background: transparent !important; } 
            <apex:outputText rendered="{!(isMobile == true)}">
                div#pblaunchpad div.forward-link-holder,
                div#pblaunchpad div.TAS_playbook_left {
                    display: none;
                }
                
                div#pblaunchpad div.TAS_playbook_right {
                    width: 100%;
                }
                
                div#pblaunchpad.smartOM {
                    min-width: 0;
                    width: 98%;
                }
                
                div.smartOMBrandingRight img {
                    height: 20px;
                }
                
                div.smartOMBrandingLeft {
                    font-weight: bold;
                    font-size: 1.0em;
                }
                
                .smartOM {
                    background-color: white;
                }
                
                div#pblaunchpad {
                    display: none;
                }
                
                ul.pb_stages {
                    font-size: 1.0em;
                }
                
                ul.pb_stages li .pb_stage_progress_bar {
                    width: 38%;
                }
                
                ul.pb_stages li .pb_stage_label {
                    padding: 0 5px 0 0;
                }
                
            #tas_app_header #tas_app_brand {
                height:10px;
                position:absolute;
                left:10px;
                top:10px;
                margin:0px;
                padding:0px;
                line-height:10px;
            }
            
                #tas_app_header #tas_app_brand img {
                    height:100%;
                    vertical-align: bottom;
                }
                
        #tas_app_header {
            position:relative;
            background-color:#e3e3e3;
            height:30px;
            border-bottom:1px solid #CCCCCC;
        }
        
            #tas_app_header #tas_app_logo {
                height:10px;
                position:absolute;
                right:10px;
                top:10px;
                margin:0px;
                padding:0px;
                line-height:10px;
            }
            
                #tas_app_header #tas_app_logo img {
                    height:100%;
                    vertical-align:bottom;
                }
                
                #tas_app_header #tas_app_logo_mobile {
	                height:20px;
	                position:absolute;
	                right: 65px;
	                top: 0px;
	                margin:0px;
	                padding:0px;
	                line-height:20px;
	            }
	            
	                #tas_app_header #tas_app_logo_mobile img {
	                    vertical-align:bottom;
	                    height: 150%;
						width: 170%;
	                }
                
                div#playbookMobile {
                    overflow: visible;
                    height: 540px;
                }
                
                ul.list_small li span.pb_stage_selected {
					color: #5979A0;
					font-weight: bold;                        
				}
            </apex:outputText>
        </style>
        
        <!--[if IE 8]>
            
            <style>
                        
                /* Conditional IE 8 styles */                           
                .transparency {
                    background: none;
                    filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{! URLFOR($Resource.Common, 'panel/images/PB_LaunchPad_Shadow.png') }', sizingMethod='scale'); 
                    margin-bottom: 10px;
                }
                
                    .unavailable { 
                        padding: 60px 0 75px;
                        position: relative;
                    }
                
                ul.pb_stages li .pb_stage_label { width: 47%; }
                
                ul.pb_stages li .pb_stage_progress_bar { width: 41%; }
                
            </style>
            
        <![endif]-->
        
            <c:jQuery jQueryUI="true" 
                underscore="true"
                dropdown="true" />
        <apex:includeScript value="{!URLFOR($Resource.DMAPP__ttgomjs, 'ttg/lib/modernizr.js')}"/>  
        <apex:includeScript value="{!URLFOR($Resource.DMAPP__ttgomjs, 'ttg/lib/ttgutils.js')}"/>   
        
    </head>
    <body>
        <div id="pblaunchpad" class="smartOM">
            <div class="smartOMBranding">
                <div class="smartOMBrandingLeft">
                    <apex:image alt="Dealmaker Logo" url="{! URLFOR($Resource.SmartOM, 'launchpad/playbook/SmartOM50.png') }" rendered="{! !isMobile }"/>
                    <apex:outputText rendered="{! isMobile }">
                      PLAYBOOK
                    </apex:outputText>
                </div>
                <div class="smartOMBrandingRight">
                  <apex:image alt="The TAS Group Logo" url="{! URLFOR($Resource.Qualification, 'TASLogo50.png') }" rendered="{! !hasBrandOverrideLogo}" />
                  <apex:image url="{! brandOverrideLogo }" rendered="{! hasBrandOverrideLogo}" />
                </div>
            </div>          
            <apex:form >
                <apex:outputPanel layout="block" rendered="{! hasNoShadowOpp || hasNoLicenses }">
                <!-- No Licenses -->                            
                <apex:outputText rendered="{! hasNoLicenses }">         
                    <p class="noLicenseText">Current user has no licenses for any module</p>                
                </apex:outputText>
                <apex:outputText rendered="{! !hasNoLicenses }">
                    <div class="transparency">
                        <apex:outputText rendered="{! !editable }">
                            <p class="unavailable">Playbook is not Available for this Opportunity</p>
                        </apex:outputText>
                        <apex:outputText rendered="{! editable }">
                            <p class="unavailable">
                                <apex:commandLink action="{!enableDealmakerOpportunity}" rerender="redirectPanel">Click to start using Playbook</apex:commandLink>
                            </p>
                        </apex:outputText>                          
                    </div>              
                </apex:outputText>  
                </apex:outputPanel>   
            
                <apex:outputPanel id="redirectPanel" >
                    <apex:outputText rendered="{! shouldRedirect }">
                        <script type="text/javascript">
                            ttg_salesforce1 ? sforce.one.navigateToURL('{! redirectUrl }') : window.top.location.href = '{! redirectUrl }';                            
                        </script>
                    </apex:outputText>
                </apex:outputPanel>                


                <apex:outputPanel layout="block" rendered="{! hasShadowOpp && !hasNoLicenses }">
                
                    <!-- No Sales Process  -->              
                    <apex:outputText rendered="{! !PlaybookLaunchpadDetails.isSalesProcess }">
                        <div class="transparency">
                            <p class="unavailable">
                                <apex:commandLink action="{!enableDealmakerOpportunity}" rerender="redirectPanel">Click to start using Playbook</apex:commandLink>
                            </p>
                        </div>
                    </apex:outputText>
                    <apex:outputText rendered="{! PlaybookLaunchpadDetails.isSalesProcess }">   
                        <div class="TAS_playbook_container">
                             
                             <!-- Playbook Left -->                          
                            <div class="TAS_playbook_left">
                    
                                <!-- Timeline -->           
                               <div class="TAS_time_bar_container">
                                   <div class="TAS_time_bar_percentage">{! PlaybookLaunchpadDetails.probability }%</div>
                                   <div class="time_bar">
                                       <div class="TAS_time_bar_start">
                                           <span class="TAS_point_marker"></span>
                                           <span class="TAS_point_value">{! PlaybookLaunchpadDetails.createdDate }</span>
                                       </div>
                                        <div class="TAS_time_bar_end">
                                            <span class="TAS_point_marker"></span>
                                            <span class="{! IF(PlaybookLaunchpadDetails.isDaysBetween, 'TAS_point_value_isDaysBetween', 'TAS_point_value') }">{! PlaybookLaunchpadDetails.projectedCloseDate }</span>
                                        </div>
                                        <div class="TAS_time_bar_length">
                                            <div class="TAS_time_bar_completed">  
                                                <div class="TAS_time_bar_marker"><span>Today</span></div>
                                            </div>
                                            <div class="TAS_time_bar_future">
                                                <div class="TAS_time_bar_extra"></div>
                                            </div>
                                        </div>                                  
                                    </div>
                                </div>
                
                                <!-- Playbook Values -->                            
                                <ul class="pb_values">
                                    <li>
                                        <span class="pb_label">Projected to Close:</span>
                                        <span class="pb_icon"><apex:image url="{! IF (PlaybookLaunchpadDetails.isProjectedThisQuarter, URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_projected_to_close.png'), URLFOR($Resource.SmartOM, 'launchpad/playbook/icon_projected_not_to_close.png')) }" /></span>
                                    </li>
                                    <li>
                                        <span class="pb_label">Deal Size: </span>
                                        <span class="pb_icon {! PlaybookLaunchpadDetails.mixClass } server-icon"></span>
                                    </li>
                                    <li class="last">
                                        <span class="pb_label">Sales Cycle:</span>
                                        <span class="pb_icon {! PlaybookLaunchpadDetails.stageDurationClass } server-icon"></span>
                                    </li>
                                </ul>                           
                            </div>
                            
                            <!-- Playbook Right -->                         
                            <div class="TAS_playbook_right">
                                <div class="forward-link-holder">
                                    <a class="forward-link" href="/apex/DMAPP__PB_Qualifiers?id={! opportunity.Id }" target="_parent"> <!-- FIXME -->
                                        <apex:image alt="Forward to Playbook" url="{! URLFOR($Resource.SmartOM, 'tabs/btn_fwd_link.png') }" />
                                    </a>
                                </div>
                                
                                <!-- Stage Completion Details -->                                   
                                <ul class="pb_stages">                  
                                    <apex:repeat value="{! PlaybookLaunchpadDetails.StageCompletionDetails }" var="StageCompletion" id="StageCompletionDetails">                                
                                        <li>
                                            <div class="pb_stage_label {! IF(StageCompletion.isCurrentStage, 'pb_stage_selected', '') }">{! StageCompletion.stageName }:<span class="pb_arrow"></span></div>
                                            <div class="pb_stage_progress_bar">
                                                <div class="pb_stage_progress_bar {! StageCompletion.progressBarStyleClass }" style="width: {! StageCompletion.percentageComplete }%"></div>
                                            </div>
                                            <div class="pb_stage_value">{! StageCompletion.percentageComplete }%</div>
                                        </li>               
                                    </apex:repeat>        
                                </ul>                       
                            </div>                              
                        </div>
                    </apex:outputText>
                </apex:outputPanel>               
                     
            </apex:form>
            

        </div>
        <script>  			
	        
	        jQuery(function() {
		        if (ttg_salesforce1) {
		        	
		        	// Salesforce1 navigation
		        	var forwardLink = jQuery('a.forward-link');
			        
			        href = forwardLink.attr('href')
			        	
			        forwardLink.removeAttr('href')
			        	.click(function() {
			       		
			       		jQuery('.overlay').toggle();
			       		sforce.one.navigateToURL(href);
			       	});
			    }
		    });
        </script>                  
 
        <apex:outputPanel rendered="{!(hasShadowOpp && PlaybookLaunchpadDetails.isSalesProcess) || hasNoLicenses}">
        <div id="playbookMobileLaunchpad" style="display: none;" class="wcontain">
            <div class="wcontain_head_grey" id="tas_app_header">
                <span class="cf" id="tas_app_brand"><apex:image url="{!URLFOR($Resource.DMAPP__Mobile, 'images/SmartOM50.png')}" alt="Dealmaker Logo"/></span>
                <span class="cf" id="tas_app_logo">
                    <apex:image url="{!URLFOR($Resource.DMAPP__Mobile, 'images/TASLogo50.png')}" alt="The TAS Group Logo" rendered="{!NOT(hasBrandOverrideLogo)}"/>
                </span>
                <span class="cf" id="tas_app_logo_mobile">
                    <apex:image url="{!brandOverrideLogo}" rendered="{!hasBrandOverrideLogo}"/>
                </span>
            </div>
            
                <div class="wcontain_body">                	
                    <apex:outputPanel rendered="{!PlaybookLaunchpadDetails.isSalesProcess && !hasNoLicenses}">
                    	<a href="#">
		                    <ul class="list_small">
		                        <apex:repeat value="{! PlaybookLaunchpadDetails.StageCompletionDetails }" var="StageCompletion" id="StageCompletionDetails">                                
		                            <li>
		                                <span class="{! IF(StageCompletion.isCurrentStage, 'pb_stage_selected', '') }">{! StageCompletion.stageName }</span>
		                                <span>
		                                    <span class="progress {! StageCompletion.mobileBarStyleClass }">
		                                        <span style="width: {! StageCompletion.percentageComplete }%"></span>
		                                    </span>
		                                </span>
		                                <span class="right_align">{! StageCompletion.percentageComplete }%</span>
		                            </li>               
		                        </apex:repeat>
		                    </ul>
                    	</a>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!hasNoLicenses}">
                        <p class="noLicenseText">Current user has no licenses for any module</p>
                    </apex:outputPanel>
                </div>
            
        </div>
        </apex:outputPanel>
        
        <!-- TODO deal with no licenses -->
        
        <apex:form styleClass="TRANSPARENT" rendered="{!isMobile && !hasSalesProcesses}">
        <div class="TRANSPARENCY" style="height: 200px;">
            <p class="unavailable">
                Playbook is not available
            </p>
        </div>
        </apex:form>
        <apex:form styleClass="TRANSPARENT" rendered="{!isMobile && hasShadowOpp && hasSalesProcesses && !PlaybookLaunchpadDetails.isSalesProcess && !hasNoLicenses}">
        <div class="TRANSPARENCY" style="height: 200px;">
            <p class="unavailable">
                <apex:commandLink action="{!enableDealmakerOpportunityMobile}" rerender="redirectPanel">Click to start using Playbook</apex:commandLink>
            </p>
        </div>
        </apex:form>
        <apex:form styleClass="TRANSPARENT" rendered="{!isMobile && hasSalesProcesses && hasNoShadowOpp && hasNoLicenses == false}">
        <div class="TRANSPARENCY" style="height: 200px;">         
            <apex:outputPanel rendered="{!editable == false}">
            <p class="unavailable">
                <apex:outputText styleClass="NOTAVAILABLE" value="Playbook is not Available for this Opportunity" rendered="{!editable == false}"/>
            </p>
            </apex:outputPanel>
            <apex:outputPanel rendered="{!editable}">
            <p class="unavailable">
                <apex:commandLink action="{!enableDealmakerOpportunityMobile}" rerender="redirectPanel">Click to start using Playbook</apex:commandLink>                        
            </p>
            </apex:outputPanel>
        </div>
        </apex:form>
        
        <div id="playbookMobile" style="display: none">
            <apex:include pageName="DMAPP__NavTabMobile" rendered="{!hasLicensesForOMOrPlaybook}" />
            <apex:outputText rendered="{! isMobile && hasShadowOpp }">
            	<c:om_playbook_app oppExtraId="{! shadowOpportunity.Id }" />
            </apex:outputText>
        </div>
        
        <script type="text/javascript">

            jQuery(function() {

                if(ttg.isMobilePhone()) {
                    jQuery('form.TRANSPARENT').hide();
                    var hasShadowOpp = {!hasShadowOpp};
                    var salesProcessSelected = {!PlaybookLaunchpadDetails.isSalesProcess};
                    var hasSalesProcesses = {!hasSalesProcesses};
                    var haslicense = !{!hasNoLicenses};
                    var redirectURL = '{!redirectUrl}';                    
                    jQuery('#pblaunchpad').hide();
                    var onFullPage = (jQuery(window).height() > 350); 
                    if(onFullPage && hasShadowOpp && hasSalesProcesses && haslicense && salesProcessSelected) {
                        jQuery('#playbookMobile').show();
                    } else {
                        jQuery('form.TRANSPARENT').show();
                        if(!redirectURL) {
                            jQuery('div#playbookMobileLaunchpad').show();
                        }
                    }
                }
            });
        </script>
    </body>   
</apex:page>